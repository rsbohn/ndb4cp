# 2025-09-01 test database for queries

## Goal

Create a dedicated SQLite database under `./test/local.db` with sample devices to exercise and validate `ndb query` behavior.

## Status

 `02:42 | ndb | git:main` via `~/.codex/bin/status`.

## Implementation

- Verified toolchain:
  - `uv run -- python --version` → Python 3.12
  - `uv run -- ndb --version` → `ndb 0.1.0`
- Initialized database:
  - `uv run -- ndb db init --path ./test/local.db`
- Inserted sample devices (varied fields for filtering):
  - `uv run -- ndb put --path ./test/local.db --uid cp-001 --hostname feather-a --ip-address 192.168.0.xxx --category cp --text '{"note":"cp feather a"}'`
  - `uv run -- ndb put --path ./test/local.db --uid cp-002 --hostname feather-b --ip-address 192.168.0.xxx --category cp --text '{"note":"cp feather b"}'`
  - `uv run -- ndb put --path ./test/local.db --uid esp-003 --hostname esp-cam --ip-address 10.0.0.xxx --category esp --text '{"note":"esp32-cam"}'`
  - `uv run -- ndb put --path ./test/local.db --uid misc-004 --hostname printer --ip-address 192.168.0.xxx --category other --text '{"note":"network printer"}'`
  - `uv run -- ndb put --path ./test/local.db --uid unlabeled-005 --text '{"note":"no host or ip"}'`

## Test Data Summary

- `cp-001`: hostname `feather-a`, ip `192.168.0.xxx`, category `cp`
- `cp-002`: hostname `feather-b`, ip `192.168.0.xxx`, category `cp`
- `esp-003`: hostname `esp-cam`, ip `10.0.0.xxx`, category `esp`
- `misc-004`: hostname `printer`, ip `192.168.0.xxx`, category `other`
- `unlabeled-005`: no hostname/ip/category (CAS-only content)

## Verification

- List all:
  - `uv run -- ndb ls --path ./test/local.db`
- Query by category:
  - `uv run -- ndb query --path ./test/local.db category=cp`
- Query by IP (JSON):
  - `uv run -- ndb query --path ./test/local.db ip_address=10.0.0.xxx --json`

## Optional: sqlite-utils

- Tables: `uvx sqlite-utils tables ./test/local.db`
- Sample rows: `uvx sqlite-utils rows ./test/local.db devices --limit 5`

This database is ready for `ndb query` testing and examples.

## Tests

 `02:50 | ndb | git:main+` via `~/.codex/bin/status`.

- Ran: `uv run -- pytest -q tests`
- Result: `4 passed in 0.25s`
